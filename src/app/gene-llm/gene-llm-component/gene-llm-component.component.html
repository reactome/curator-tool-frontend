<h1 class="section_title">Use LLM to Annotate a Gene in Reactome</h1>

<!--Enter a gene-->
<div>
    <mat-label>Enter a gene: </mat-label>
    <input matInput placeholder="TANC1" #geneInput value="TANC1">
    <button mat-button (click)="queryGene(geneInput.value)">Submit</button>
</div>

<mat-spinner *ngIf="during_query"></mat-spinner>

<section *ngIf="!during_query">
    <!--Show the content generated by LLM-->
    <div *ngIf="failure">
        <h4 class="title">Failure</h4>
        <p [innerHTML]="failure"></p>
    </div>

    <section *ngIf="annotated_pathway_content">
        <div>
            <br>
            <mat-divider></mat-divider>
            <h2 class="section_title">Annotated Pathways</h2>
            <p class="note">The query gene has been annotated in Reactome. Its annotation is sumarized below with a
                focus on its
                roles in reactions annotated in the pathway(s).
            </p>
            <h4 class="title">Summary</h4>
            <p class="note">The text is generated by LLM, which summarizes the annotated roles of the gene in the
                pathway(s).</p>
            <p [innerHTML]="annotated_pathway_content"></p>
        </div>

        <div *ngIf="details">
            <h4 class="title">Details</h4>
            <p class="note">The summary of individual pathways annotated for the gene in Reactome.</p>
            <p [innerHTML]="annotated_pathway_details"></p>
        </div>

    </section>

    <section *ngIf="content">
        <div>
            <br>
            <mat-divider></mat-divider>
            <br>
            <h2 class="section_title">Predicted Interacting Pathways</h2>
            <p class="note">The query gene may be functionally interacting with annotated pathways based on Reactome.
                The app tried to match PubMed abstracts together with interacting pathways for curators.
            </p>
            <h4 class="title">Summary</h4>
            <p class="note">The text is generated by LLM, which collects abstracts best aligned with predicted
                interacting
                pathways for the query gene.</p>
            <p [innerHTML]="content"></p>
        </div>

        <div *ngIf="details">
            <h4 class="title">Details</h4>
            <p class="note">The text is generate by LLM, which collects the best matched abstract for each of the
                predicted
                interacting pathways for the query gene.</p>
            <!--Switch this to use a template-->
            <div *ngFor="let detail of details">
                <p style="font-weight: bold;">
                    PMID: <a href="https://pubmed.ncbi.nlm.nih.gov/{{detail.pmid}}" target="pubmed">{{detail.pmid}}</a>
                    vs
                    PATHWAY: <a href="https://reactome.org/PathwayBrowser/#/{{detail.pathwayId}}"
                        target="reactome">{{detail.pathway}}</a>
                </p>
                <p [innerHTML]="detail.text"></p>
                <p>
                    <mat-expansion-panel hideToggle class="mat-elevation-z0" (afterExpand)="fetchFullText(detail)">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Click to process the full text paper
                            </mat-panel-title>
                            <mat-panel-description>
                                Relationships between the query gene and other biological concepts will be extracted
                            </mat-panel-description>
                        </mat-expansion-panel-header>
                        <p>
                            <mat-progress-spinner mode="indeterminate"
                                *ngIf="!detail.fullPaperResults && detail.isWorkingFullText"></mat-progress-spinner>
                        </p>
                        <p *ngIf="detail.failure" class="error">{{detail.failure}}</p>
                        <p *ngIf="detail.needPDFFile">
                            You may try to upload a PDF file here (The uploaded file will be kept at the server for some
                            time):
                            <!--The following file upload is based on https://blog.angular-university.io/angular-file-upload/ 
                            More features should be added: e.g. monitor progress, cancel, etc. -->
                            <input type="file" class="file_input" accept="application/pdf" (change)="uploadPDFFile($event, detail)" #fileUpload>
                            {{detail.pdfUrl || "No file uploaded yet."}}
                            <button mat-button color="primary" (click)="fileUpload.click()">
                                Choose a File
                            </button>
                        </p>
                        <ol *ngIf="detail.fullPaperResults">
                            <li *ngFor="let result of detail.fullPaperResults">
                                <h4 class="title">Extracted Relationships</h4>
                                <p [innerHTML]="result.content"></p>
                                <h4 class="title">Source Text from the Full Paper</h4>
                                <p [innerHTML]="result.docs"></p>
                            </li>
                        </ol>
                    </mat-expansion-panel>
                </p>
            </div>
        </div>
    </section>
</section>