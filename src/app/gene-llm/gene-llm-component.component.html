<h1 class="section_title">Use LLM to Annotate a Gene in Reactome</h1>

<!-- Args:
gene (str): _description_
model (_type_): _description_
fi_cutoff (float, optional): Default=0.8. Used to filter the pulled PPIs.
fdr_cutoff (float, optional): _description_. Defaults to 1.0E-2.
pathway_count (int, optional): _description_. Defaults to 8.
total_words (int, optional): _description_. Defaults to 300. -->

<!--Enter a gene-->
<div class="center">
    <div
        style="display: flex; margin: auto; align-items: center; justify-content: center; margin-top: 15px; margin-bottom: 5px;">
        <div class="gene_label">
            <label>Enter a gene:</label>
        </div>

        <div class="gene_input">
            <input type="text" style="height: 24px;" placeholder="TANC1" [value]="gene"
                (change)="onGeneChange(geneInput.value)" #geneInput matInput />
        </div>

        <div class="button_container">
            <button style="cursor: pointer;" matTooltip="Submit gene for processing" mat-icon-button
                (click)="queryGene()">
                <mat-icon>publish</mat-icon>
            </button>

            <button style="margin-left: 10px; cursor: pointer;" matTooltip="Edit Configurations"
                (click)="changeShowConfiguration()" mat-icon-button>
                <mat-icon>
                    settings
                </mat-icon>
            </button>
        </div>
    </div>
    <ng-container *ngIf="showConfiguration">
        <app-configuration-component [setGene]="gene"
            (getConfig)="setConfiguration($event)"></app-configuration-component>
    </ng-container>
    <br>
</div>

<mat-spinner *ngIf="during_query"></mat-spinner>

<section *ngIf="!during_query">
    <!--Show the content generated by LLM-->
    <div *ngIf="failure">
        <h4 class="title">Failure</h4>
        <p [innerHTML]="failure"></p>
    </div>

    <mat-sidenav-container style="left: 20px;" *ngIf="!during_query">
        <mat-sidenav *ngIf="content" #sidenav mode="side" opened class="menu_style">
            <app-navigation-menu></app-navigation-menu>
        </mat-sidenav>

        <mat-sidenav-content>
            <!-- Annotated Pathways Content  -->
            <section *ngIf="annotated_pathway_content" id="pathway_content">
                <div>
                    <br>
                    <mat-divider></mat-divider>
                    <h2 class="section_title">Annotated Pathways</h2>
                    <p class="note">The query gene has been annotated in Reactome. Its annotation is sumarized below
                        with a
                        focus on its
                        roles in reactions annotated in the pathway(s).
                    </p>
                    <h4 class="title">Summary</h4>
                    <p class="note">The text is generated by LLM, which summarizes the annotated roles of the gene
                        in
                        the
                        pathway(s).</p>
                </div>
                <mat-card class="text-block-card" appearance="outlined">
                    <p sytle="text-align: left !important;" [innerHTML]="annotated_pathway_content"></p>
                </mat-card>
            </section>

            <!-- Pathway Details -->
            <section *ngIf="annotated_pathway_details" id="pathway_details">
                <h4 class="title">Details</h4>
                <p class="note">The summary of individual pathways annotated for the gene in Reactome.</p>
                <mat-card class="text-block-card" appearance="outlined">
                    <p [innerHTML]="annotated_pathway_details"></p>
                </mat-card>
            </section>

            <!-- content -->
            <section *ngIf="content" id="content">
                <br>
                <mat-divider></mat-divider>
                <h2 class="section_title">Predicted Pathways</h2>
                <h4 class="title">Summary</h4>
                <p class="note">The query gene may be annotated into Reactome pathways based on protein-protein
                    interactions filtered
                    by predicted functional interactions. The app tried to match PubMed abstracts together with pathways
                    for curators.
                </p>
                <mat-card class="text-block-card" appearance="outlined">
                    <p [innerHTML]="content"></p>
                </mat-card>
            </section>

            <!-- Docs -->
            <section *ngIf="details" id="details">
                <h4 class="title">Details</h4>
                <p class="note">The text is generate by LLM, which collects the best matched abstracts for each of the
                    predicted target pathways for the query gene.</p>
                <mat-card class="text-block-card" appearance="outlined">
                    <!--Switch this to use a template-->
                    <app-predicted-pathway-details (fullTextDetails)="fetchFullText($event)"
                        (pdfFileDetails)="uploadPDFFile($event)" [details]="details"></app-predicted-pathway-details>
                </mat-card>
            </section>


            <!-- Pathway to PPI Abstract Summary Data -->
            <section *ngIf="tableData" id="gene2PPi">
                <h4 class="title">Protein-Protein Interactions Supporting Annotation</h4>
                <p class="note">Protein-protein interactions, collected from IntAct and BioGRID and supported by
                    functional interaction data,
                    are used to infer Reactome pathways for annotation.</p>
                <div style="display: flex">
                    <mat-card class="text-block-card" appearance="outlined">
                        <!-- Don't use this element if class is setup mat-card-content -->
                        <ng-container *ngFor="let e of tableData; let last = last">
                            <h4 id="">{{e.pathway_name}}</h4>
                            <app-protein-partners-table style="margin: auto;"
                                [data]="e.data"></app-protein-partners-table>
                            <br>
                            <p>{{e.summary}}</p>
                            <br *ngIf="!last">
                                <mat-divider></mat-divider>
                            <br *ngIf="!last">
                        </ng-container>
                        <!-- /mat-card-content -->
                    </mat-card>
                </div>
            </section>

        </mat-sidenav-content>
    </mat-sidenav-container>
</section>